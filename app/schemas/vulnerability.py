from pydantic import BaseModel, UUID4
from typing import Optional
from app.models.vulnerability import PoCType, VulnerabilitySeverity, VulnerabilityStatus
from datetime import datetime


class VulnerabilityBase(BaseModel):
    title: str
    description: str  # This matches the model field name
    severity: VulnerabilitySeverity = VulnerabilitySeverity.MEDIUM
    status: VulnerabilityStatus = VulnerabilityStatus.OPEN
    poc_type: PoCType
    poc_code: Optional[str] = None
    poc_zip_path: Optional[str] = "N/A"  # Default value to avoid null issues


class VulnerabilityCreate(VulnerabilityBase):
    project_id: UUID4


class VulnerabilityUploadPoc(BaseModel):
    poc_code: str
    poc_type: PoCType


class Vulnerability(VulnerabilityBase):
    id: UUID4
    project_id: UUID4
    discovered_by: UUID4
    fixed_by: Optional[UUID4] = None
    created_at: datetime
    updated_at: Optional[datetime] = None
    fixed_at: Optional[datetime] = None

    class Config:
        from_attributes = True
